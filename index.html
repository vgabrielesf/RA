<!DOCTYPE html>
<html>
<head>
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width, initial-scale=1">
    <title>AR Cube - Vers√£o Simplificada</title>
    
    <!-- A-Frame -->
    <script src="https://aframe.io/releases/1.4.0/aframe.min.js"></script>
    
    <!-- AR.js -->
    <script src="https://jeromeetienne.github.io/AR.js/aframe/build/aframe-ar.min.js"></script>
    
    <style>
        body {
            margin: 0;
            font-family: Arial, sans-serif;
        }
        
        #info {
            position: fixed;
            top: 10px;
            left: 10px;
            right: 10px;
            background: rgba(0, 0, 0, 0.8);
            color: white;
            padding: 15px;
            border-radius: 10px;
            z-index: 9999;
            font-size: 12px;
            text-align: center;
        }
        
        #info h3 {
            margin: 0 0 10px 0;
            color: #00ff88;
        }
        
        .hide { display: none; }
        
        button {
            background: #ff4444;
            color: white;
            border: none;
            padding: 8px 16px;
            border-radius: 5px;
            margin: 5px;
            cursor: pointer;
        }
        
        .success { background: #28a745 !important; }
    </style>
</head>
<body style='margin : 0px; overflow: hidden;'>
    
    <div id="info">
        <h3>üîÑ Carregando AR...</h3>
        <p>Aguarde e permita acesso √† c√¢mera</p>
        <button onclick="hideInfo()">OK</button>
        <button class="success" onclick="testCamera()">Testar C√¢mera</button>
    </div>

    <!-- Cena AR Simplificada -->
    <a-scene 
        arjs='sourceType: webcam; trackingMethod: best; sourceWidth:1280; sourceHeight:960; displayWidth: 1280; displayHeight: 960; debugUIEnabled: false;' 
        embedded
        vr-mode-ui="enabled: false">
        
        <a-marker preset='hiro'>
            <!-- Cubo Principal -->
            <a-box 
                position='0 0.5 0' 
                material='color: #4CC3D9; transparent: false; opacity: 1;'
                animation="property: rotation; to: 0 360 0; loop: true; dur: 5000">
                
                <!-- Texto -->
                <a-text 
                    value="AR" 
                    position="0 0 0.51" 
                    align="center" 
                    color="white" 
                    scale="2 2 2">
                </a-text>
            </a-box>
            
            <!-- Cubo menor -->
            <a-box 
                position='1.5 0.5 0' 
                scale='0.5 0.5 0.5' 
                material='color: red;'
                animation="property: rotation; to: 360 0 360; loop: true; dur: 3000">
            </a-box>
            
            <!-- Esfera -->
            <a-sphere 
                position='-1.5 0.5 0' 
                radius='0.3' 
                material='color: yellow;'
                animation="property: position; to: -1.5 2 0; loop: true; dur: 2000; dir: alternate">
            </a-sphere>
            
        </a-marker>
        
        <a-entity camera></a-entity>
    </a-scene>

    <script>
        let cameraWorking = false;
        
        function hideInfo() {
            document.getElementById('info').classList.add('hide');
        }
        
        async function testCamera() {
            const infoDiv = document.getElementById('info');
            
            try {
                infoDiv.innerHTML = '<h3>üîç Testando c√¢mera...</h3><p>Aguarde...</p>';
                
                // Verificar se getUserMedia existe
                if (!navigator.mediaDevices?.getUserMedia) {
                    throw new Error('getUserMedia n√£o suportado neste navegador');
                }
                
                // Tentar acessar a c√¢mera
                const stream = await navigator.mediaDevices.getUserMedia({ 
                    video: { 
                        facingMode: { ideal: 'environment' },
                        width: { ideal: 640 },
                        height: { ideal: 480 }
                    } 
                });
                
                // Sucesso!
                cameraWorking = true;
                stream.getTracks().forEach(track => track.stop());
                
                infoDiv.innerHTML = `
                    <h3>‚úÖ C√¢mera OK!</h3>
                    <p>Agora aponte para o marcador Hiro</p>
                    <p><small>Marcador: quadrado preto com padr√£o branco</small></p>
                    <button onclick="hideInfo()">Come√ßar AR</button>
                    <button onclick="showMarkerInfo()">Ver Marcador</button>
                `;
                
            } catch (error) {
                console.error('Erro c√¢mera:', error);
                infoDiv.innerHTML = `
                    <h3>‚ùå Erro na C√¢mera</h3>
                    <p><strong>Problema:</strong> ${error.message}</p>
                    <p><strong>Solu√ß√µes:</strong></p>
                    <ul style="text-align: left; font-size: 11px;">
                        <li>Permita acesso √† c√¢mera</li>
                        <li>Use HTTPS (GitHub Pages funciona)</li>
                        <li>Feche outras apps que usam c√¢mera</li>
                        <li>Recarregue a p√°gina</li>
                    </ul>
                    <button onclick="location.reload()">Recarregar</button>
                `;
            }
        }
        
        function showMarkerInfo() {
            document.getElementById('info').innerHTML = `
                <h3>üéØ Marcador Hiro</h3>
                <p>Procure por um quadrado preto com bordas brancas e um padr√£o espec√≠fico dentro</p>
                <p>Voc√™ pode:</p>
                <ul style="text-align: left; font-size: 11px;">
                    <li>Usar o arquivo marcador.html</li>
                    <li>Buscar "hiro marker" no Google</li>
                    <li>Imprimir ou mostrar em outra tela</li>
                </ul>
                <button onclick="hideInfo()">Entendi</button>
            `;
        }
        
        // Auto-inicializar
        window.addEventListener('load', () => {
            setTimeout(() => {
                if (!cameraWorking) {
                    testCamera();
                }
            }, 2000);
        });
        
        // Detectar marcador
        document.addEventListener('DOMContentLoaded', () => {
            setTimeout(() => {
                const marker = document.querySelector('a-marker');
                if (marker) {
                    marker.addEventListener('markerFound', () => {
                        console.log('Marcador encontrado!');
                        if (!document.getElementById('info').classList.contains('hide')) {
                            document.getElementById('info').innerHTML = `
                                <h3>üéâ Marcador Detectado!</h3>
                                <p>Veja o cubo 3D!</p>
                                <button onclick="hideInfo()">Ocultar</button>
                            `;
                        }
                    });
                    
                    marker.addEventListener('markerLost', () => {
                        console.log('Marcador perdido');
                    });
                }
            }, 3000);
        });
    </script>
</body>
</html>
